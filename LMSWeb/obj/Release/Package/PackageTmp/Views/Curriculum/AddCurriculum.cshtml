
﻿@model LMSBL.DBModels.tblCurriculum
@{
    ViewBag.Title = "Add Curriculum";
    Layout = "~/Views/Shared/_LayoutNew.cshtml";
}

<style>

    table.dataTable thead .sorting_asc {
        background: url("http://cdn.datatables.net/1.10.0/images/sort_asc.png") no-repeat center left;
    }

    table.dataTable thead .sorting_desc {
        background: url("http://cdn.datatables.net/1.10.0/images/sort_desc.png") no-repeat center left;
    }

    table.dataTable thead .sorting {
        background: url("http://cdn.datatables.net/1.10.0/images/sort_both.png") no-repeat center left;
    }

    .modal {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        opacity: 0;
        visibility: hidden;
        transform: scale(1.1);
        transition: visibility 0s linear 0.25s, opacity 0.25s 0s, transform 0.25s;
    }

    .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 1rem 1.5rem;
        width: 24rem;
        border-radius: 0.5rem;
    }

    .close-button {
        float: right;
        width: 1.5rem;
        line-height: 1.5rem;
        text-align: center;
        cursor: pointer;
        border-radius: 0.25rem;
        background-color: lightgray;
    }

        .close-button:hover {
            background-color: darkgray;
        }

    .show-modal {
        opacity: 1;
        visibility: visible;
        transform: scale(1.0);
        transition: visibility 0s linear 0s, opacity 0.25s 0s, transform 0.25s;
    }
</style>
@using (Html.BeginForm("AddForum", "Forum", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()

    <div class="container-fluid mt-4 mb-4 pl-4 pr-4">
        @if (!string.IsNullOrEmpty(Convert.ToString(TempData["Message"])))
        {
            if (Convert.ToString(TempData["Message"]) == "1")
            {
                <script>
                    swal.fire("Forum Saved Successfully")
                        .then((value) => {
                            window.location.href = "Index";
                        });
                </script>
            }
            else
            {
                <script>
                    swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'There is problem in saving Forum!'
                    })
                </script>
            }

        }
        <div class="row justify-content-center h-100">
            <div class="col align-self-center add-user-section ">
                <div class="col">
                    @if (Model.CurriculumId == 0)
                    {
                        <h4 class="mt-3 ml-2 mb-3">New Curriculum</h4>
                    }
                    else
                    {
                        <h4 class="mt-3 ml-2 mb-3">Edit Curriculum</h4>
                    }
                </div>
                <div class="row pt-5 pl-4">
                    <div class="col-sm-6">

                        @Html.HiddenFor(model => model.CurriculumId)

                        @Html.TextBoxFor(model => model.CurriculumTitle, new { @class = "input100", placeholder = "Curriculum Title" })

                        <button type="button" id="btnAddActivity" class="btn btn-primary profle-submit-btn mr-4 trigger"><i class="fas fa-plus-circle"></i> Add Activity</button>
                    </div>





                </div>
                <div class="row mt-3" id="dvActivityData">
                    <div class="table-responsive">
                        <table class="table" id="activityTable">
                            <thead>
                                <tr>
                                    <th scope="col">Sr No.</th>
                                    <th scope="col">Activity Title</th>
                                    <th scope="col">Activity Type</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody id="tBody">

                                <tr>
                                    <td colspan="8">No User Available</td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>

                <br />
                <div class="row justify-content-end pr-4">
                    <button type="submit" id="btnForumSubmit" class="btn btn-primary profle-submit-btn mr-4"><img src="~/assets/images/check-img.png" /> Save Changes</button>
                    <button type="submit" onclick="location.href='@Url.Action("Index", "Forum")';return false;" class="btn btn-outline-primary cancel-btn"><i class="far fa-times-circle"></i> Cancel</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Modal -->

    <div id="dialog" style="display: none">
        Activity Type
        <select id="lstActivityType" class="input100">
            <option value="0">Select</option>
            <option value="1">Course</option>
            <option value="2">Survey</option>
            <option value="3">Forum</option>
        </select>
        <div id="dvAxtivities">
            Select activities
            <select id="lstAxtivities" name="lstAxtivities" size="5" multiple>
            </select>
            <button type="button" id="btnAddActivityToList" class="btn btn-primary profle-submit-btn mr-4 trigger"><i class="fas fa-plus-circle"></i> Add Activity</button>
        </div>

    </div>


}

<script src="~/assets/Validations.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.9/jquery-ui.js" type="text/javascript"></script>
<link href="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.9/themes/blitzer/jquery-ui.css"
      rel="stylesheet" type="text/css" />
<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/rowreorder/1.2.7/js/dataTables.rowReorder.min.js"></script>

<link href="https://cdn.datatables.net/rowreorder/1.2.7/css/rowReorder.dataTables.min.css"
      rel="stylesheet" type="text/css" />

<script>
    $(function () {
        $("#dialog").dialog({
            modal: true,
            autoOpen: false,
            title: "Select activity to add",
            width: 600,
            height: 400,
            draggable: false,
            resizable:false,
            show: {
                effect: 'fade',
                duration: 1000
            }
        }).prev(".ui-dialog-titlebar").css("background","#fb6300");
        $("#btnAddActivity").click(function () {
            $('#dialog').dialog('open');
        });
    });
    $(document).ready(function () {
        $("#dvAxtivities").hide();
        $("#lstActivityType").on("change", function () {
            var selectedType = $("#lstActivityType option:selected").val();
            if (selectedType == 0) {
                $("#dvAxtivities").hide();
            }
            else {
                ShowData(selectedType);
            }
        });

         $('#btnAddActivityToList').on("click", function () {
             AddActivityToList();
        });
        var editor;

        $('#activityTable').DataTable({
            "aaSorting": [],
            "paging": true,
            "ordering": true,
            "rowReorder":  {
                selector: 'td:nth-child(1)'
            },
            "info": true,
            "bFilter": true,
            "pageLength": 10,
            "pagingType": "simple_numbers",
            data: curriculumActivities,
                columns: [
                    { data: 'activityId', className: 'reorder' },
                    { data: 'activityText' },
                    {
                        data: null,
                        className: "center",
                        defaultContent: '<a onclick="deleteRecord(this)" class="editor_remove">Delete</a>'
                    }
                ],
            aoColumnDefs: [
                {

                }
            ]

        });
        $('#activityTable_filter').hide();

    });
    function deleteRecord(id) {
        alert(id);
    }

    function ShowData(selectedType) {
            $.ajax({
                type: "POST",
                 url: '@Url.Action("GetActivities")',
                data: '{selectedType: ' + JSON.stringify(selectedType) + '}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                //success: OnSuccess(response),
                success: function (response) {
                    OnSuccess(response);
                },
                failure: function (response) {
                    swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'Something went Wrong!'
                })
                }
            });
        }
    function OnSuccess(response) {
            var data = response;
            //console.log(data);
            $('[id*=lstAxtivities]').empty();
            var listBox = $('[id*=lstAxtivities]');
            $.map(data, function (item) {
                var option = document.createElement('option');
                option.text = item.Name;
                option.value = item.Value;
                listBox[0].append(option);
            });
            $("#dvAxtivities").show();
        }

    var curriculumActivities = [];

    function AddActivityToList() {
        var isSelected = false;
        $('#lstAxtivities option').each(function(index) {
          if(($(this).is(':selected')))
          {
              optionItem = {}
              optionItem["activityId"] = this.value;
              optionItem["activityText"] = this.text;
              curriculumActivities.push(optionItem);
              isSelected = true;
          }

        });
        if (!isSelected) {
            swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: 'Please select Activity!'
            })
        }
        else {
            //$("#tBody").empty();
            //$.each(curriculumActivities, function(index, value) {
            //        var tr = "<tr>";
            //        tr += "<td>" + value.activityId + "</td>";
            //        tr += "<td>" + value.activityText + "</td>";
            //        tr += "<td>" + "<input type='button' id='" + value.activityId + "' onclick='deleteRecord(" + value.activityId + ")' value='Delete'>" + "</td>" + "</tr>";
            //        $("#tBody").append(tr);
            //    });
            //$("#activityTable").DataTable();
            // var table = $('#activityTable').DataTable( {
            // rowReorder: true
            //} );

             //table.draw();

            var table = $('#activityTable').DataTable();
            //table.data = curriculumActivities;

            table.clear().rows.add(curriculumActivities).draw();
            //table.draw();
            //table.rowReordering();
        }
        console.log(curriculumActivities);
    }
</script>
